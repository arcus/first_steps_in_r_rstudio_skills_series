---
format: 
  revealjs:
    theme: [serif, custom.scss]
    scrollable: true
    logo: media/chop_arcus_initiative_logo.png
    footer: Arcus Education, Children's Hospital of Philadelphia 
    css: styles.css
---
## Welcome {.smaller}

These slides available at: <https://arcus.github.io/first_steps_in_r_rstudio_skills_series/session_2.html>

-   Use keyboard arrow keys to
    -   advance ( → ) and
    -   go back ( ← )
-   Type "s" to see speaker notes
-   Type "?" to see other keyboard shortcuts

```{r echo = FALSE}
library(countdown)
```


::: notes
As always, I'd like to encourage you to open these slides on your own browser, and this first slide helps with tips for you to use the slide deck.
:::

## About Arcus / Your Presenter {.smaller}

::::: {.columns .v-center-container}
::: {.column .small-text width="60%"}
Arcus is an initiative by the Research Institute aimed at promoting data discovery and reuse and increasing research reproducibility.

-   Arcus app: <https://arcus.chop.edu>
-   Arcus Sharepoint site: <https://chop365.sharepoint.com/sites/Arcus>

Among the many teams in Arcus, I represent Arcus Education!

![](media/arcus_website.png){.two-thirds .bordered fig-alt="Arcus website which displays tools and services including cohort discovery, arcus archives, data catalog, education and training, scientific projects, and clinical data query."}
:::

::: {.column .small-text width="40%"}
![](media/arcus_research_data_lifecycle.png){fig-alt="A circular diagram showing five project phases, including Discover: explore available data, Plan: plan your research project, Collect: receive your data, Analyze: analyze data in an Arcus lab, and Share: contribute data to archives."}
:::
:::::

::: notes

Thanks again for joining us, and welcome to our session today!   My name is ______ [add pronouns here if you want], and I'll be leading today's session.

I've already talked a bit about Arcus in the first session of this Skills Series, but I'm including the slide here so that you have those links available in case you want to learn more about Arcus.
:::

## Arcus Education

::::: {.columns .v-center-container}
::: {.column .small-text width="50%"}
![](media/arcus_education_page.png){.bordered fig-alt="Education website page that includes three sections titled Getting Started with Arcus, Learn Data Science Skills, and Curate Your Own Learning Experience."}
:::

::: {.column .small-text width="50%"}
Arcus education provides data science training to researchers ...

(and often this is useful to non-researchers too!).

<https://arcus.chop.edu/i-want-to/arcus-education>

Email us! [arcus-education\@chop.edu](mailto:arcus-education@chop.edu){.email}
:::
:::::

::: notes
The Arcus Education team does lots of different kinds of education, and we've already discussed this previously in other workshop sessions.  You can always email us at arcus dash education at chop dot edu to ask about how we can help you!
:::


## First Steps in R and RStudio {.smaller}

Arcus Education provides "Skills Series" for the entire CHOP community.

This Skills Series is a 5-session series aimed at helping you take your first steps in R and RStudio!

-   Session 1: Review and Setup
-   Session 2: Projects and File Ingestion
-   Session 3: Exploring Data Visually, Using ggplot2
-   Session 4: Selecting Data Using dplyr
-   Session 5: Putting it All Together: Communicating

::: notes
Just a reminder about what you're in today.

This is a five-session series, and our goal is to help you get started taking your first steps.  Today, we're in session three, right smack dab in the middle of our work together.
:::

## Session 3 Itinerary {.smaller}

Exploring Data Visually, Using ggplot2

  * ggplot2 syntax
  * Mapping Aesthetics 
  * Setting Visuals
  * Color Palettes

Goals:

- Describe what an "aesthetic mapping" is in ggplot2
- Create a simple ggplot2 data visualization
- Add a label (like a title or an x-axis label) to a plot in ggplot2

::: notes
Today, our topic is exploring data visually, using the ggplot2 package.  We'll go over how to use ggplot2, including some specific topics like mapping and setting visual elements and the use of color palettes.

My goals for you today include the following.  I'd like for you to be able to explain what an aesthetic mapping is in ggplot2, because this is an area where a lot of people tend to stumble.  I hope you'll have been able to create a simple ggplot2 visualization by the end of our session, and I think you'll be able to add a label to a plot by the end of today.  Let's start by explaining what ggplot2 is!

:::


## ggplot2

![](media/ggplot2_hex.png){.half fig-align="center"}{fig-alt="ggplot2 logo."}

::: notes
We'll be using the `ggplot2` package for creating graphics. `ggplot2` is a package that forms part of the tidyverse, so it will get loaded when you load the tidyverse package.

`ggplot2` (and its main function, plain old `ggplot` without the 2) provides a "**grammar of graphics**" for data visualization. That's what the "GG" is in ggplot: grammar of graphics.  The idea of having a "grammar" for something is actually pretty common in R. Essentially, there should be a consistent way to build any type of "thing" in R, in this case, any type of graph. A common grammar that is easy to repeat every time.

The idea of the grammar of graphics is that you should be able to specify any type of graph by specifying the data that goes into it, the type of graph that you want to make, and a mapping that describes how the data should be represented as visual marks on that graph.

Having a consistent grammar means that once you learn how to make, say, a histogram, that knowledge can be applied to make a scatter plot or a box plot or a violin plot with little extra effort. This makes it easy to generate lots of different graphs quickly which helps you understand your data more quickly.

Also, `ggplot2` graphs look great and the package can be used to generate publication-quality plots.
:::

## The "grammar" of ggplot

::: {.columns .v-center-container}
::: {.column .smaller-text width="35%"}

* Step 1: Pick a tidy data frame to pass to `ggplot` as an argument
:::

:::{.column .smaller-text width="40%"}
`ggplot(data = cirrhosis_study)`
:::
::: {.column .smaller-text width="35%"}
* Step 2: Pick a "geom" function
:::

:::{.column .smaller-text width="40%"}

:::
::: {.column .smaller-text width="35%"}
* Step 3: Write aesthetic mappings
:::

:::{.column .smaller-text width="40%"}

:::

:::

::: notes

We'll go over each of these steps in detail, but here is the overall grammar we're going to talk about.  There are also optional enrichment steps that you can add that will really make your data visualizations shine, but these are the absolutely required steps for the bare minimum kinds of plots.

You first need to choose a tidy data frame.  We'll describe what a tidy data frame is in just a moment.  
Then you will choose a geom, or a kind of visualization, a geometric representation.  A geom might be a bar graph, or a line graph, for example.
Finally, you'll tell ggplot how to map the data to the visual parts of the geom you chose.  What columns should be shown on which axes, for example?

Let's take a closer look at each step.

:::

## Step 1: Tidy Data 

* Columns measure **just one variable** and don't have any merging or combining
* Rows each represent **just one observation** and don't include variables
* There's no merging of cells that make names or values shared

::: notes
A data set can take on a lot of different shapes with different styles of organizing data. The one method or shape that is best suited for data analysis is known as "tidy".

We won't cover "tidy" data in detail in this workshop. It's sufficient at this point to know that tidy data is in a rectangular shape with rows and columns, and:

-   Columns each measure just one variable (so, no "doubling up" with first and last name in the same column, or race and gender in the same column) and
-   Rows each constitute a single observation (like a patient, or a vial, or a city block) at a point in time
-   Each value is in its own cell (with no merging or splitting of cells)

:::

## Example: Untidy vs Tidy

::::: {.columns .v-center-container}
::: {.column .smaller-text width="45%"}

**Untidy**

```{=html}
<table style = "border: 1px black; font-size:50%; cellpadding:0.5em; cellspacing:0">
<span style="left: initial; text-decoration: inherit;"><tbody><tr><td style="padding: 0.5em;
border: 0px;">
</td>
<td colspan="2" style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 1</p>
</td>
<td colspan="2" style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 2</p>
</td>
<td colspan="2" style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 3</p>
</td>
<td colspan="2" style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 4</p>
</td></tr>
<tr><td style="padding: 0.5em;">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>pre</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>post</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>pre</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>post</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>pre</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>post</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>pre</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>post</p>
</td>        </tr><tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 1</p>
<p>(n=6m, 14f)</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>        </tr><tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 2</p>
<p>(n=12m,8f)</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important"></td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">

</td>        </tr><tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 3</p>
<p>(n=10m, 10f)</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
</tr><tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 4</p>
<p>(n=5m, 15f)</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td></tr></tbody></span></table>
```
    
:::

::: {.column .smaller-text width="55%"}

:::

:::

::: notes

OK, let's say you study group performance.  So you have several different groups that you bring into the lab.  You're doing an experiment where you form a team of 20 strangers, and you're measuring their ability to perform four tasks as a team.  You measure their performance before and after having them watch a full season of Dora the Explorer, to see if that improves their creativity and enthusiasm for adventure.  

On the left is the kind of table you might see published in a journal.  It's compact, but it is not tidy.  You can see that the sex makeup of the teams, which varies from team to team, is listed in the rows.  But that varies, which means it's a variable, and variables should go in columns, not rows.  And we also have header cells that merge across two columns.  This is a perfectly adequate table for publication, but it's not tidy and not ready for use in the tidyverse.

We could make it tidy, and I'm going to show you how in the next slide.

:::


## Example: Untidy vs Tidy

::::: {.columns .v-center-container}
::: {.column .smaller-text width="45%"}

**Untidy**

```{=html}
<table style = "border: 1px black; font-size:50%; cellpadding:0.5em; cellspacing:0">
<span style="left: initial; text-decoration: inherit;"><tbody><tr><td style="padding: 0.5em;
border: 0px;">
</td>
<td colspan="2" style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 1</p>
</td>
<td colspan="2" style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 2</p>
</td>
<td colspan="2" style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 3</p>
</td>
<td colspan="2" style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 4</p>
</td></tr>
<tr><td style="padding: 0.5em;">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>pre</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>post</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>pre</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>post</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>pre</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>post</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>pre</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>post</p>
</td>        </tr><tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 1</p>
<p>(n=6m, 14f)</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>        </tr><tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 2</p>
<p>(n=12m,8f)</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important"></td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">

</td>        </tr><tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 3</p>
<p>(n=10m, 10f)</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
</tr><tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 4</p>
<p>(n=5m, 15f)</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td></tr></tbody></span></table>
```
    
:::

::: {.column .smaller-text width="55%"}
**Tidy**

```{=html}
<table style = "border: 1px black; font-size:50%; cellpadding:0.5em; cellspacing:0">
<span style="left: initial; text-decoration: inherit;"><tbody>
<tr><td style="padding: 0.5em;">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>Intervention Stage</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>N Males</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>N Females</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 1</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 2</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 3</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>Measure 4</p>
</td>
</tr>
<tr>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 1</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
Pre
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
6
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
14
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
</tr>
<tr>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 1</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
Post
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
6
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
14
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
</tr>
<tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 2</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
Pre
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
12
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
8
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td></tr>
<tr>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 2</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
Post
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
12
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
8
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
</tr>
<tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 3</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
Pre
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
10
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
10
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td></tr>
<tr>
<td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 3</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
Post
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
10
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
10
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
</tr>
<tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 4</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
Pre
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
5
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
15
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td></tr>
<tr><td style="padding: 0.5em; border: 1px solid black !important">
<p>Team 4</p>
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
Post
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
5
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
15
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td>
<td style="padding: 0.5em; border: 1px solid black !important">
</td></tr>
</tbody></span></table>
```
:::

:::

::: notes

On the left is our not tidy data, and on the right, I've made it tidy.

Let's think about what columns are and what rows are.  Rows are observations, and the fact is that we observe each team twice, so we're going to have two rows for each team.

And columns are variables.  What can be different from observation to observation?  Well, pre versus post is one variable that we think and hope will change the outcome.  The number of males and females can differ from group to group, too.  These first three columns are just kind of re-arranged a little bit from the information we already had.

Can everyone see that this is another way to capture the same data?  It might not be as compact as what you would put in a print journal, but this is tidy data, which is what will make working in R possible!  All the variables are in columns, all the observations are in rows, there's no doubling up of values.


:::

## Tidy, or Not Tidy? 

::: {.tiny-text}

| ID_Arm   | N_Days | Status | Age   | Sex | AHS Status |
| :--- | :----- | :----- | :---- | :-- | :--------- |
| 1_D  | 400    | D      | 21464 | F   | Y/Y/Y      |
| 2_D  | 4500   | C      | 20617 | F   | N/Y/Y      |
| 3_D  | 1012   | D      | 25594 | M   | N/N/N      |
| 4_D  | 1925   | D      | 19994 | F   | N/Y/Y      |
| 5_P  | 1504   | CL     | 13918 | F   | N/Y/Y      |
| 6_P  | 2503   | D      | 24201 | F   | N/Y/N      |
| 7_P  | 1832   | C      | 20284 | F   | N/Y/N      |
| 8_P  | 2466   | D      | 19379 | F   | N/N/N      |
| 9_D  | 2400   | D      | 15526 | F   | N/N/Y      |
| 10_P | 51     | D      | 25772 | F   | Y/N/Y      |
| 11_P | 3762   | D      | 19619 | F   | N/Y/Y      |
| 12_P | 304    | D      | 21600 | F   | N/N/Y      |
| 13_P | 3577   | C      | 16688 | F   | N/N/N      |
| 14_P | 1217   | D      | 20535 | M   | Y/Y/N      |
| 15_D | 3584   | D      | 23612 | F   | N/N/N      |
| 16_P | 3672   | C      | 14772 | F   | N/N/N      |
| 17_P | 769    | D      | 19060 | F   | N/Y/N      |
| 18_D | 131    | D      | 19698 | F   | N/Y/Y      |
:::

::: notes

OK, so now I'd like to ask you -- is this tidy data?  Is there any data out of place, cells that are merged, rows that should be columns, columns that should be rows?  The first column is the ID, which has the ID and the arm, which is either drug or placebo.  The next column is the length of time the subject remained in the study.  The third column is the final disposition of the subject, whether they left the study due to death, organ transplantation, or the end of the study.  Then the age of the patient at the time they left the study, the sex of the patient, and their status with regard to ascites, hePATomegaly, and spider angiomas.

What do you think?  I'll invite you to give your reasoning in chat.

:::


## Tidy, or Not Tidy?

::: {.tiny-text}

| ID  | N_Days | Status | Drug            | Age   | Sex | Ascites | Hepatomegaly | Spiders |
| :-- | :----- | :----- | :-------------- | :---- | :-- | :------ | :----------- | :------ |
| 1   | 400    | D      | D-penicillamine | 21464 | F   | Y       | Y            | Y       |
| 2   | 4500   | C      | D-penicillamine | 20617 | F   | N       | Y            | Y       |
| 3   | 1012   | D      | D-penicillamine | 25594 | M   | N       | N            | N       |
| 4   | 1925   | D      | D-penicillamine | 19994 | F   | N       | Y            | Y       |
| 5   | 1504   | CL     | Placebo         | 13918 | F   | N       | Y            | Y       |
| 6   | 2503   | D      | Placebo         | 24201 | F   | N       | Y            | N       |
| 7   | 1832   | C      | Placebo         | 20284 | F   | N       | Y            | N       |
| 8   | 2466   | D      | Placebo         | 19379 | F   | N       | N            | N       |
| 9   | 2400   | D      | D-penicillamine | 15526 | F   | N       | N            | Y       |
| 10  | 51     | D      | Placebo         | 25772 | F   | Y       | N            | Y       |
| 11  | 3762   | D      | Placebo         | 19619 | F   | N       | Y            | Y       |
| 12  | 304    | D      | Placebo         | 21600 | F   | N       | N            | Y       |
| 13  | 3577   | C      | Placebo         | 16688 | F   | N       | N            | N       |
| 14  | 1217   | D      | Placebo         | 20535 | M   | Y       | Y            | N       |
| 15  | 3584   | D      | D-penicillamine | 23612 | F   | N       | N            | N       |
| 16  | 3672   | C      | Placebo         | 14772 | F   | N       | N            | N       |
| 17  | 769    | D      | Placebo         | 19060 | F   | N       | Y            | N       |
| 18  | 131    | D      | D-penicillamine | 19698 | F   | N       | Y            | Y       |

:::

::: notes

OK, and is this data in a tidy format?  This, by the way, is a snippet of the actual data you're working with in this series.

Let me know what you think in chat.  Yes, indeed, this is tidy data!

Importantly, for these five workshop sessions, we're giving you data that's already in a tidy data format.  We're not going to go over how to make your data tidy, because that work is boring and I want you to have fun doing the exciting stuff that will get you enthusiastic about R. I'm giving you some data that's artificially beautiful.  Real research data is messy, and real clinical data is even messier.

:::

## The "grammar" of ggplot

::: {.columns .v-center-container}
::: {.column .smaller-text width="25%"}

* Step 1: Pick a tidy data frame to pass to `ggplot` as an argument
:::

:::{.column .smaller-text width="70%"}
`ggplot(data = cirrhosis_study)`
:::
::: {.column .smaller-text width="25%"}
* Step 2: Pick a "geom" function
:::

:::{.column .smaller-text width="70%"}

:::
::: {.column .smaller-text width="25%"}
* Step 3: Write aesthetic mappings
:::

:::{.column .smaller-text width="70%"}

:::

:::
::: notes

So that was step 1.  This is what it looks like in code.  This is a very simple example, where we're just passing the most important piece of information, the name of the tidy data frame, as the first argument to ggplot2. 

Let's go on to Step 2.

:::

## Step 2: Pick a "geom" function

There are lots of ways to depict data geometrically:


::::::: columns
::: {.column width="10%"}
![](media/geom_histogram_mini.png)
:::

::: {.column width="40%"}
`geom_histogram()`
:::

::: {.column width="10%"}
![](media/geom_dotplot_mini.png)
:::

::: {.column width="40%"}
`geom_dotplot()`
:::
:::::::

::::::: columns
::: {.column width="10%"}
![](media/geom_bar_mini.png)
:::

::: {.column width="40%"}
`geom_bar()`
:::

::: {.column width="10%"}
![](media/geom_boxplot_mini.png)
:::

::: {.column width="40%"}
`geom_boxplot()`
:::
:::::::

::::::: columns
::: {.column width="10%"}
![](media/geom_point_mini.png)
:::

::: {.column width="40%"}
`geom_point()`
:::

::: {.column width="10%"}
![](media/geom_line_mini.png)
:::

::: {.column width="40%"}
`geom_line()`
:::
:::::::

::: notes
Here are a few useful geom functions for visualizing data, but there are many more. With these six you can make histograms, bar plots, scatter plots, dot plots, boxplots, and line graphs.  Your data is probably very rich, and with the same data, you could show group distributions using a box plot or violin plot, or show time series data using a line plot, or show how two variables interact using a point plot, or show the frequency of various values using a histogram, or show correlation strength using a heatmap, or lots of other things, all with the same tidy data frame.  So you have to think about what specific kind of data visualization you want!
:::

## The "grammar" of ggplot

::: {.columns .v-center-container}
::: {.column .smaller-text width="25%"}

* Step 1: Pick a tidy data frame to pass to `ggplot` as an argument
:::

:::{.column .smaller-text width="70%"}
`ggplot(data = cirrhosis_study) +`
:::
::: {.column .smaller-text width="25%"}
* Step 2: Pick a "geom" function
:::

:::{.column .smaller-text width="70%"}
`  geom_histogram()`
:::
::: {.column .smaller-text width="25%"}
* Step 3: Write aesthetic mappings
:::

:::{.column .smaller-text width="70%"}

:::

:::
::: notes

So now we've added a bit to our code.  We've put a plus sign after the first line of code, which is a way to tell ggplot that we're going to add a new layer to our data visualization.  ggplot2 works by allowing you to add layer upon layer of geometric visualizations, labels, themes, and adjustments to your graph, so that you build it up a little at a time.  That plus sign says, "I'm not done yet, please keep reading!".

The second line of code says "I'd like this specific shape, please: a histogram."  ggplot knows what a histogram is.  So you're one step closer to that visualization.  But you're not done yet.  ggplot knows that it needs one variable to be able to make a histogram.  It doesn't need two, as in the case of, say, a scatter plot of points, where it would need an X and a Y axis value.  No, it just needs one value, because it's going to plot the frequency of various values of this variable.  But you haven't told it which variable you want to use!
:::

## Step 3: Aesthetic Mappings

![](media/aesthetics.png){.half fig-align="center"}

Aesthetic mappings connect __columns__ to visible __attributes__.

::: notes
OK, so aesthetic mappings can be tricky.  So if you're multi-tasking, I need you to stop writing that email, because this is where a lot of people trip up and make mistakes, including me, and I've been coding in R for a decade.

-   An **aesthetic mapping** is a rule that tells ggplot how to visualize the data, for example, using color or position, according to the value of a **specific column of the data**. These are elements that would result in a different looking visualization if you were to change the data being provided. For example, the height of a bar changes depending on the data. Maybe you might show female patients as dots of one color and male patients as dots of another color, so if you correct a patient's sex in the data, their dot will change color. You're **mapping** patient sex to a visible characteristic, color.  It's really important to remember that mapping aesthetics will always come down to **selecting a specific column** from your data frame.  

Of course, there are other visual elements of a data visualization that **wouldn't** automatically change if you change the data you provide. For instance, maybe we just like green and we want ALL the points on our graph to be green. We're not changing the color based on data, we're not connecting the color to just one column of data, so it's not considered a mapping. When we're setting a fixed aesthetic that isn't affected by data, we don't put these assignments inside the aes parentheses.  We don't MAP those within aesthetics, we SET those outside.  

:::
## Aesthetic Mappings

::: {.columns .v-center-container}
::: {.column  width="45%"}

::: {.smaller-text}
| Spiders | Cholesterol | Albumin |
| :------ | :---------- | :------ |
| Y       | 261         | 2.6     |
| Y       | 302         | 4.14    |
| N       | 176         | 3.48    |
| Y       | 244         | 2.54    |
| Y       | 279         | 3.53    |
| N       | 248         | 3.98    |
| N       | 322         | 4.09    |
:::




::: 
::: {.column width="55%"}

Spiders: <span style="color:blue">•</span><span style="color:red">•</span> (Color)

Cholesterol: ↔ (X axis)

Albumin: ↕ (Y axis)

:::
:::
        

## Aesthetic Mappings

::: {.columns .v-center-container}
::: {.column  width="45%"}

::: {.smaller-text}
| Spiders | Cholesterol | Albumin |
| :------ | :---------- | :------ |
| Y       | 261         | 2.6     |
| Y       | 302         | 4.14    |
| N       | 176         | 3.48    |
| Y       | 244         | 2.54    |
| Y       | 279         | 3.53    |
| N       | 248         | 3.98    |
| N       | 322         | 4.09    |
:::




::: 
::: {.column width="55%"}

Spiders: <span style="color:blue">•</span><span style="color:red">•</span> (Color)

Cholesterol: ↔ (X axis)

Albumin: ↕ (Y axis)

```


mapping = aes(x = Cholesterol,
              y = Albumin,
              color = Spiders)
              
              
```

:::

:::



::: notes
Don't worry if mapping aesthetics versus setting fixed aesthetics seems a bit fuzzy at first -- it can be tricky to grapple with, and will become clearer over time as you gain more experience manipulating visualizations in R. Even advanced coders sometimes mess this up.

Let's consider an example in our cirrhosis data frame.

We can imagine mapping the values in the "Cholesterol" column, which is numerical, to the x axis. 
With the "Albumin" column, also numerical, we can map those values to the y axis. 
And for the column called "Spiders", which has categorical data with "Y" and "N" values, we can imagine mapping that to colors.

Can you envision what that graph might look like?  It would probably be a scatter plot that would have points of two different colors, at least that's what I'm picturing in my mind.

The mapping in ggplot would be within the aes parentheses, as you see on your screen.

Note that R automatically figures out reasonable axis limits and a color scale, but you can fine tune this manually.
:::

## Participation Time! {.smaller}

![](media/aesthetics.png){.half fig-align="center"}

In addition to x/y position and color, what other aesthetic **mappings** can you think of?

(Hint: things that don't change when the data changes, like the background color of a graph or the font or title of a graph, aren't **mappings**).

Type your answers in the chat!

::: notes
Okay, time to fire up the chat window again. Type into chat some examples of other aesthetic **mappings**. Keep in mind that if something is set in a fixed way and it's the same regardless of the data, that's not a mapping.
:::

## The "grammar" of ggplot

::: {.columns .v-center-container}
::: {.column .smaller-text width="25%"}

* Step 1: Pick a tidy data frame to pass to `ggplot` as an argument
:::

:::{.column .smaller-text width="70%"}
`ggplot(data = cirrhosis_study) +`
:::
::: {.column .smaller-text width="25%"}
* Step 2: Pick a "geom" function
:::

:::{.column .smaller-text width="70%"}
`  geom_histogram(aes (x = Cholesterol))`
:::
::: {.column .smaller-text width="25%"}
* Step 3: Write aesthetic mappings
:::

:::{.column .smaller-text width="70%"}
(you can put these in either of the 2 lines above...)
:::

:::
::: notes

OK, so we've gotten to the mapping bits.  We know we have to put an aes function in, but where does it go?  The answer is that it can go in a couple of places.  We've said we want to do a histogram, which only needs a single variable defined, the X axis variable. Let's say we want to map the Cholesterol column to that x axis.  If you want, you can put the aes function that maps your Cholesterol to your x axis all the way at the top, in the ggplot function.  The benefit to doing that is that every geom that you add on as a layer will inherit that and will know that Cholesterol maps to the x axis.  Some people like doing it that way.

But I prefer to put the aes, the aesthetic mapping, in the geom function.  That's because sometimes I will have several different geoms and I want to map different things in different geoms.  It's a little tricky to think about, so for now what I want you to do is put the mapping in the geom you're working in, but I want you to not be too surprised if you see that some people put it at the top, in the ggplot part of the syntax.  That's okay, too, and it just gets inherited by all the geoms below it.

:::

## Your Turn! {.smaller}

* Go to https://posit.cloud and log in.
* Find your First Steps in R and RStudio project and open it
* In the file browser (lower right), navigate to Exercises
* Open session_3_exercise.qmd, and start reading and working in it!
* If you **save** this file, save it with your initials at the end (rename it).
* If you get stuck, there's a solutions file in the "solutions" folder, or jump into chat!
* I'd love for everyone to work quietly for around 10 minutes, and then I'll demo "Your Turn" 1-6.
* You can do as many as you like: 1-6 will get you through today's goals, 7-14 are "bonus content"!
* I'll stop us all for a couple of closing slides and for Q&A as we get close to the end of the hour.


## Summary of Today {.smaller}

Today, you:

* Learned about the grammar of graphics
* Evaluated whether data was "tidy" or not
* Learned about mapping data to visual aesthetics
* Created some simple (and some not-so-simple) data visualizations
* Labeled your data visualizations
* Probably worked with some error messages and maybe some help files

That's a lot!  Give yourselves a round of applause.

::: notes
OK, so that's session 3.  Today, we talked about ggplot2.  And you did a lot of hands-on work, too!  If you have a feeling word you want to drop into chat, I'd love to know how today left you feeling!
:::


## Q&A / Was This Effective? {.smaller}

We like to measure our effectiveness (and analyze it in R!)

Goals:

- Describe what an "aesthetic mapping" is in ggplot2
- Create a simple ggplot2 data visualization
- Add a label (like a title or an x-axis label) to a plot in ggplot2


::: notes

The Arcus education team is a group that likes to measure our effectiveness and make changes based on what we learn.  So before we do questions and answers and our final slides, we like to make sure to give our learners a poll to see if we made a good use of your time.  We're going to ask if we were effective in reaching our goals today, and those goals are on the screen in order to help you answer that question.  Once you answer that poll, feel free to type a question into chat or come off mute and ask to clarify anything I can explain a bit better.  

:::



## Next Session

Selecting Data Using `dplyr`

  * Selecting columns
  * Filtering rows
  * Creating new columns
  

::: notes

In our next session, we're going to talk about how to select, reshape, filter, and work with our data using the dplyr package, which is another useful package from the tidyverse suite of tools.  I'm looking forward to seeing you there.  Thanks so much for your hard work today.  If you have questions between today and next week, feel free to email me at paytonk@chop.edu or arcus-education@chop.edu, and have a great rest of your day!
:::


